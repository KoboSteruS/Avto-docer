# Импорт отзывов из JSON

## Описание

Скрипт для импорта отзывов из JSON файла (экспорт из старой БД) в новую базу данных Django.

## Использование

### Базовый запуск

```bash
python manage.py import_reviews path/to/reviews.json
```

### Параметры

- `json_file` (обязательный) - путь к JSON файлу с отзывами
- `--dry-run` - показать, какие отзывы будут импортированы, без фактического создания
- `--skip-existing` - пропускать отзывы, которые уже существуют (по имени и тексту)
- `--default-rating {1,2,3,4,5}` - рейтинг по умолчанию (по умолчанию: 5)

### Примеры

1. **Тестовый запуск (без сохранения):**
```bash
python manage.py import_reviews reviews.json --dry-run
```

2. **Импорт с пропуском существующих:**
```bash
python manage.py import_reviews reviews.json --skip-existing
```

3. **Импорт с рейтингом 4 по умолчанию:**
```bash
python manage.py import_reviews reviews.json --default-rating 4
```

4. **Полный импорт:**
```bash
python manage.py import_reviews reviews.json
```

## Формат JSON файла

Скрипт ожидает JSON файл в формате экспорта из PHPMyAdmin с таблицей `f9vru_easybook`:

```json
[
  {
    "type": "table",
    "name": "f9vru_easybook",
    "data": [
      {
        "name": "Имя клиента",
        "text": "Текст отзыва",
        "created_at": "2021-07-12 07:34:13"
      }
    ]
  }
]
```

## Обработка данных

- **HTML-сущности** (`&quot;`, `&amp;` и т.д.) автоматически декодируются
- **Текст** обрезается до 1000 символов (ограничение модели)
- **Имя** обрезается до 100 символов
- **Дата** парсится из формата `YYYY-MM-DD HH:MM:SS`
- **Автомобиль** устанавливается как "Не указано" (поле обязательное, но в старых отзывах нет)
- **Рейтинг** устанавливается по умолчанию (5 звезд)
- **Публикация** - все импортированные отзывы сразу публикуются (`is_published=True`)

## Статистика

После завершения импорта выводится статистика:
- Количество импортированных отзывов
- Количество пропущенных отзывов
- Количество ошибок

## Примечания

- Скрипт автоматически обрабатывает кодировку UTF-8
- Пустые отзывы (без имени или текста) пропускаются
- При ошибке парсинга даты используется текущая дата
- При использовании `--skip-existing` проверка происходит по имени и первым 100 символам текста
